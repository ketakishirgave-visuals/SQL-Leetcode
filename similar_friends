-- explanation:
-- two copies of listening data are joined
-- common songs on the same day are counted

select f.user1,
       f.user2
from friends f
join listenings l1
  on l1.user_id = f.user1
join listenings l2
  on l2.user_id = f.user2
 and l1.song_id = l2.song_id
 and l1.day = l2.day
group by f.user1, f.user2
having count(distinct l1.song_id) >= 3;
